/* ── Variables — Yaru Dark GTK-4 ─────────────────────────────────────────── */
/* Derived from gtk/src/default/gtk-4.0/_palette.scss + _colors.scss         */
/* $jet: #181818; lighten/darken computed from SCSS formulas                 */
:root {
  /* Surfaces */
  --bg-primary:    #2c2c2c;   /* $bg_color    = lighten($jet, 8%)           */
  --bg-secondary:  #272727;   /* $base_color  = lighten($jet, 6%)           */
  --bg-sidebar:    #2a2a2a;   /* $sidebar_bg_color = mix($bg, $base, 50%)   */
  --bg-input:      #272727;   /* $base_color                                */
  --bg-bubble-user:var(--accent-orange); /* tracks system accent colour      */
  --bg-bubble-asst:#272727;   /* $base_color                                */
  --bg-code:       #1d1d1d;   /* $menu_color  = lighten($jet, 2%)           */

  /* Accent colours */
  --accent-orange: #E95420;   /* Ubuntu $orange — brand + links             */
  --accent-green:  #17a81a;   /* $success_color ≈ lighten($green #0e8420, 5%) */
  --accent-red:    #c7162b;   /* $red                                       */
  --accent-yellow: #f99b11;   /* $yellow                                    */

  /* Text */
  --text-primary:  #F7F7F7;   /* $porcelain = $fg_color (dark)              */
  --text-dim:      #929292;   /* mix($fg_color, $bg_color, 50%)             */
  --text-user:     #ffffff;
  --text-sidebar:  #c8c8c6;   /* slightly dimmed primary for sidebar        */

  /* Borders — $borders_edge = transparentize($fg_color, 0.93)              */
  --border-subtle: rgba(247, 247, 247, 0.07);
  --border-code:   rgba(233, 84, 32, 0.45);

  /* Radii */
  --radius:        8px;
  --radius-bubble: 14px;

  /* System font — overridden at runtime from gsettings */
  --system-font:      'Ubuntu', system-ui, sans-serif;
  --system-mono:      'Ubuntu Mono', monospace;
  --system-font-size: 14px;
}

/* ── Reset ───────────────────────────────────────────────────────────────── */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html, body {
  height: 100%;
  font-family: var(--system-font);
  font-size: 14px;
  background: var(--bg-primary);
  color: var(--text-primary);
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* ── App layout: sidebar + main ─────────────────────────────────────────── */
#app {
  flex: 1;
  min-height: 0;
  display: flex;
  font-size: var(--system-font-size);
}

/* ── Sidebar rail (always visible) ────────────────────────────────────────── */
#sidebar-rail {
  width: 48px;
  flex-shrink: 0;
  background: var(--bg-sidebar);
  border-right: 1px solid var(--border-subtle);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 8px 0;
  gap: 4px;
}

.rail-spacer { flex: 1; }

/* Rail buttons (hamburger, help, new-chat) */
#sidebar-rail button {
  width: 36px;
  height: 36px;
  background: transparent;
  border: none;
  border-radius: var(--radius);
  color: var(--text-dim);
  cursor: pointer;
  transition: background 0.15s, color 0.15s;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  font-size: 1rem;
  font-family: var(--system-font);
  font-weight: 700;
}

#sidebar-rail button:hover {
  background: rgba(255, 255, 255, 0.1);
  color: var(--text-primary);
}

/* ── Sidebar panel (collapsible) ─────────────────────────────────────────── */
#sidebar-panel {
  width: 220px;
  flex-shrink: 0;
  background: var(--bg-sidebar);
  border-right: 1px solid var(--border-subtle);
  display: flex;
  flex-direction: column;
  padding: 16px;
  gap: 16px;
  overflow-y: auto;
  overflow-x: hidden;
  transition: width 200ms ease, padding 200ms ease, opacity 200ms ease;
}

/* Collapsed panel */
#app.sidebar-collapsed #sidebar-panel {
  width: 0;
  padding: 0;
  opacity: 0;
  border-right: none;
  overflow: hidden;
}

.sidebar-header {
  display: flex;
  align-items: center;
  gap: 10px;
}

.ubuntu-logo {
  width: 28px;
  height: 28px;
  border-radius: 6px;
  flex-shrink: 0;
}

.sidebar-header h1 {
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--accent-orange);
}

#system-info-panel {
  flex: 1;
  overflow-y: auto;
}

#system-info-panel h2 {
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--text-dim);
  margin-bottom: 4px;
  font-weight: 500;
}

.system-info-subtitle {
  font-size: 0.68rem;
  color: var(--text-dim);
  opacity: 0.7;
  margin-bottom: 12px;
  font-style: italic;
}

/* System info grouped sections */
.sysinfo-group {
  margin-bottom: 10px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border-subtle);
}

.sysinfo-group:last-child {
  border-bottom: none;
  margin-bottom: 0;
  padding-bottom: 0;
}

.sysinfo-group-label {
  font-size: 0.62rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--text-dim);
  margin-bottom: 4px;
  font-weight: 500;
  font-family: var(--system-font);
}

#system-info-content {
  font-size: 0.75rem;
  font-family: var(--system-mono);
  color: var(--text-sidebar);
  line-height: 1.6;
}

.nf-row {
  display: flex;
  gap: 6px;
  margin-bottom: 1px;
}

#system-info-content dt {
  flex-shrink: 0;
  width: 74px;
  text-align: right;
  color: var(--accent-orange);
  font-weight: 700;
}

#system-info-content dd {
  flex: 1;
  min-width: 0;
  color: var(--text-sidebar);
  word-break: break-word;
}

.sidebar-footer {
  margin-top: auto;
}

#clear-btn {
  width: 100%;
  padding: 8px 12px;
  background: transparent;
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius);
  color: var(--text-dim);
  cursor: pointer;
  font-size: 0.85rem;
  font-family: var(--system-font);
  transition: border-color 0.15s, color 0.15s, background 0.15s;
}

#clear-btn::before {
  content: "+ ";
  color: var(--accent-orange);
  font-weight: 700;
}

#clear-btn:hover {
  background: rgba(233, 84, 32, 0.1);
  border-color: var(--accent-orange);
  color: var(--accent-orange);
}

/* ── Main chat area ──────────────────────────────────────────────────────── */
#chat-area {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-width: 0;
  position: relative;
}

/* ── Welcome state ──────────────────────────────────────────────────────── */
#welcome-state {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 40px 24px;
  text-align: center;
}

#welcome-state .welcome-logo {
  width: 56px;
  height: 56px;
  margin-bottom: 8px;
  border-radius: 12px;
}

#welcome-state h2 {
  font-size: 1.3rem;
  font-weight: 700;
  color: var(--text-primary);
}

#welcome-state .welcome-desc {
  font-size: 0.9rem;
  color: var(--text-dim);
  margin-bottom: 20px;
}

.suggestion-chips {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 8px;
  max-width: 520px;
}

.suggestion-chip {
  padding: 8px 16px;
  background: var(--bg-secondary);
  border: 1px solid var(--border-subtle);
  border-radius: 20px;
  color: var(--text-primary);
  font-size: 0.85rem;
  font-family: var(--system-font);
  cursor: pointer;
  transition: border-color 0.15s, background 0.15s, color 0.15s;
}

.suggestion-chip:hover {
  border-color: var(--accent-orange);
  background: rgba(233, 84, 32, 0.1);
  color: var(--accent-orange);
}

/* ── Status overlay ──────────────────────────────────────────────────────── */
#status-overlay {
  position: absolute;
  inset: 0;
  background: var(--bg-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 100;
}

.status-box {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  color: var(--text-dim);
}

.spinner {
  width: 36px;
  height: 36px;
  border: 3px solid var(--border-subtle);
  border-top-color: var(--accent-orange);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin { to { transform: rotate(360deg); } }

#status-text { font-size: 0.9rem; }

/* ── Download progress bar ──────────────────────────────────────────────── */
#download-progress {
  width: 320px;
  text-align: center;
}

#download-bar-track {
  width: 100%;
  height: 6px;
  background: var(--border-subtle);
  border-radius: 3px;
  overflow: hidden;
}

#download-bar-fill {
  height: 100%;
  width: 0%;
  background: var(--accent-orange);
  border-radius: 3px;
  transition: width 0.3s ease;
}

/* Indeterminate animation when total is unknown */
#download-bar-fill.indeterminate {
  width: 40%;
  animation: indeterminate 1.4s ease-in-out infinite;
}

@keyframes indeterminate {
  0%   { transform: translateX(-100%); }
  100% { transform: translateX(350%); }
}

#download-detail {
  margin-top: 8px;
  font-size: 0.78rem;
  color: var(--text-dim);
  font-family: var(--system-mono);
}

/* ── Messages ────────────────────────────────────────────────────────────── */
#messages {
  flex: 1;
  overflow-y: auto;
  padding: 20px 24px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  scroll-behavior: smooth;
}

/* ── Chat bubbles ────────────────────────────────────────────────────────── */
.bubble {
  max-width: 88%;
  padding: 10px 14px;
  border-radius: var(--radius-bubble);
  line-height: 1.6;
  word-break: break-word;
}

.bubble-user {
  align-self: flex-end;
  max-width: 80%;
  background: var(--bg-bubble-user);
  color: var(--text-user);
  border-bottom-right-radius: 4px;
}

.bubble-assistant {
  align-self: flex-start;
  background: var(--bg-bubble-asst);
  color: var(--text-primary);
  border-bottom-left-radius: 4px;
  border: 1px solid var(--border-subtle);
}

/* ── Markdown inside assistant bubbles ───────────────────────────────────── */
.markdown-body { line-height: 1.7; }

.markdown-body p { margin-bottom: 0.6em; }

.markdown-body ul,
.markdown-body ol {
  padding-left: 1.4em;
  margin-bottom: 0.6em;
}

.markdown-body li { margin-bottom: 0.2em; }

.markdown-body h1,
.markdown-body h2,
.markdown-body h3 {
  color: var(--accent-orange);
  margin: 0.8em 0 0.4em;
  font-weight: 700;
}

.markdown-body code {
  font-family: var(--system-mono);
  font-size: 0.88em;
  color: #f07b53;
  background: var(--bg-code);
  padding: 1px 5px;
  border-radius: 4px;
}

/* Code block panels */
.code-panel {
  position: relative;
  border: 1px solid var(--border-code);
  border-radius: var(--radius);
  overflow: hidden;
  margin: 0.6em 0;
}

/* Copy button */
.copy-btn {
  position: absolute;
  top: 6px;
  right: 8px;
  padding: 2px 10px;
  background: rgba(0, 0, 0, 0.4);
  border: 1px solid var(--border-subtle);
  border-radius: 4px;
  color: var(--text-dim);
  font-size: 0.72rem;
  font-family: inherit;
  cursor: pointer;
  opacity: 0;
  transition: opacity 0.15s, color 0.15s, border-color 0.15s;
  z-index: 2;
  line-height: 1.6;
}

.code-panel:hover .copy-btn {
  opacity: 1;
}

.copy-btn:hover {
  color: var(--text-primary);
  border-color: rgba(255, 255, 255, 0.3);
}

.copy-btn.copied {
  color: var(--accent-green);
  border-color: var(--accent-green);
  opacity: 1;
}

.code-panel pre {
  margin: 0;
  overflow-x: auto;
}

.code-panel pre code {
  display: block;
  padding: 12px 14px;
  background: var(--bg-code) !important;
  color: var(--text-primary);
  font-size: 0.87em;
  line-height: 1.55;
  border-radius: 0;
}

/* Override hljs background to match ours */
.hljs { background: var(--bg-code) !important; }

.markdown-body blockquote {
  border-left: 3px solid var(--accent-orange);
  padding-left: 12px;
  color: var(--text-dim);
  margin: 0.6em 0;
}

.markdown-body a {
  color: var(--accent-orange);
  text-decoration: underline;
  text-underline-offset: 2px;
}

.markdown-body a:hover {
  text-decoration: none;
}

.markdown-body table {
  border-collapse: collapse;
  width: 100%;
  margin: 0.6em 0;
}

.markdown-body th,
.markdown-body td {
  border: 1px solid var(--border-subtle);
  padding: 6px 10px;
  text-align: left;
}

.markdown-body th { color: var(--accent-orange); }

/* ── Tool call collapsible ───────────────────────────────────────────────── */
.tool-calls {
  align-self: flex-start;
  max-width: 80%;
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius);
  overflow: hidden;
  font-size: 0.8rem;
}

.tool-calls summary {
  padding: 6px 10px;
  cursor: pointer;
  color: var(--text-dim);
  background: var(--bg-secondary);
  user-select: none;
  list-style: none;
}

.tool-calls summary::-webkit-details-marker { display: none; }

.tool-calls summary:hover { color: var(--text-primary); }

.tool-calls-body {
  padding: 10px 12px;
  background: var(--bg-code);
  color: var(--text-dim);
  font-family: var(--system-mono);
  font-size: 0.78rem;
  white-space: pre-wrap;
  word-break: break-all;
  max-height: 200px;
  overflow-y: auto;
}

/* ── Input bar ───────────────────────────────────────────────────────────── */
#input-bar {
  display: flex;
  gap: 8px;
  padding: 12px 20px 16px;
  background: var(--bg-primary);
  border-top: 1px solid var(--border-subtle);
  align-items: flex-end;
}

#user-input {
  flex: 1;
  resize: none;
  background: var(--bg-input);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius);
  color: var(--text-primary);
  font-size: 0.95rem;
  font-family: var(--system-font);
  padding: 10px 14px;
  line-height: 1.5;
  min-height: 42px;
  max-height: 200px;
  overflow-y: auto;
  transition: border-color 0.15s, box-shadow 0.15s;
  outline: none;
}

#user-input:focus {
  border-color: var(--accent-orange);
  box-shadow: 0 0 0 2px rgba(233, 84, 32, 0.2);
}

#user-input::placeholder { color: var(--text-dim); }

#user-input:disabled { opacity: 0.5; cursor: not-allowed; }

#send-btn {
  padding: 10px 20px;
  background: var(--accent-orange);
  border: none;
  border-radius: var(--radius);
  color: #fff;
  font-size: 0.95rem;
  font-weight: 600;
  font-family: var(--system-font);
  cursor: pointer;
  transition: filter 0.15s;
  white-space: nowrap;
  min-width: 72px;
  height: 42px;
}

#send-btn:hover:not(:disabled) { filter: brightness(1.1); }

#send-btn:disabled { opacity: 0.4; cursor: not-allowed; }

/* ── Thinking indicator ──────────────────────────────────────────────────── */
.thinking-bubble {
  padding: 12px 18px;
}

.thinking-dots {
  display: inline-flex;
  gap: 5px;
  align-items: center;
}

.thinking-dots span {
  width: 7px;
  height: 7px;
  border-radius: 50%;
  background: var(--accent-orange);
  opacity: 0.25;
  animation: thinking-pulse 1.2s ease-in-out infinite;
}

.thinking-dots span:nth-child(2) { animation-delay: 0.2s; }
.thinking-dots span:nth-child(3) { animation-delay: 0.4s; }

@keyframes thinking-pulse {
  0%, 80%, 100% { opacity: 0.25; transform: scale(0.85); }
  40%            { opacity: 1;    transform: scale(1.1);  }
}

/* ── Scrollbar styling ───────────────────────────────────────────────────── */
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.15); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--accent-orange); }

/* ── Welcome zoom hint ───────────────────────────────────────────────────── */
.welcome-zoom-hint {
  font-size: 0.75rem;
  color: var(--text-dim);
  opacity: 0.7;
  margin-top: 16px;
}

/* ── Help overlay ────────────────────────────────────────────────────────── */
.help-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 200;
  display: flex;
  align-items: center;
  justify-content: center;
  animation: help-fade-in 0.15s ease;
}

@keyframes help-fade-in {
  from { opacity: 0; }
  to   { opacity: 1; }
}

.help-panel {
  background: var(--bg-primary);
  border: 1px solid var(--border-subtle);
  border-radius: 12px;
  max-width: 560px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  padding: 28px 32px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.help-panel h2 {
  font-size: 1.2rem;
  font-weight: 700;
  color: var(--accent-orange);
  margin-bottom: 20px;
}

.help-section {
  margin-bottom: 20px;
}

.help-section:last-child {
  margin-bottom: 0;
}

.help-section h3 {
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--text-dim);
  font-weight: 500;
  margin-bottom: 8px;
}

.help-section p {
  font-size: 0.85rem;
  color: var(--text-primary);
  line-height: 1.6;
  opacity: 0.85;
}

.shortcuts-table {
  width: 100%;
  border-collapse: collapse;
}

.shortcuts-table tr {
  border-bottom: 1px solid var(--border-subtle);
}

.shortcuts-table tr:last-child {
  border-bottom: none;
}

.shortcuts-table td {
  padding: 6px 0;
  font-size: 0.85rem;
}

.shortcuts-table td:first-child {
  width: 140px;
  padding-right: 12px;
}

.shortcuts-table td:last-child {
  color: var(--text-primary);
  opacity: 0.85;
}

.kbd {
  display: inline-block;
  background: var(--bg-code);
  border: 1px solid var(--border-subtle);
  border-radius: 4px;
  padding: 1px 6px;
  font-size: 0.78rem;
  font-family: var(--system-mono);
  color: var(--text-primary);
  line-height: 1.6;
}

/* ── Light theme — Yaru Light GTK-4 ─────────────────────────────────────── */
/* Overrides applied when the system prefers a light colour scheme           */
@media (prefers-color-scheme: light) {
  :root {
    /* Surfaces */
    --bg-primary:    #F2F2F2;   /* Yaru light window background               */
    --bg-secondary:  #FFFFFF;   /* content / base surface                     */
    --bg-sidebar:    #EBEBEB;   /* sidebar rail                               */
    --bg-input:      #FFFFFF;   /* input field                                */
    --bg-bubble-asst:#FFFFFF;   /* assistant bubble                           */
    --bg-code:       #F6F6F6;   /* code block                                 */

    /* Text */
    --text-primary:  #2c2c2c;   /* near-black, ~$jet                          */
    --text-dim:      #5c5c5c;   /* secondary / placeholder — WCAG AA on bg    */
    --text-sidebar:  #3d3d3d;   /* sidebar labels                             */

    /* Borders — stronger than dark-mode so elements read clearly             */
    --border-subtle: rgba(0, 0, 0, 0.15);

    /* Code — darker background so blocks stand out from the window surface   */
    --bg-code:       #E8E8E8;
  }

  /* Rail buttons — dark icons on light background */
  #sidebar-rail button {
    color: var(--text-dim);
  }

  #sidebar-rail button:hover {
    background: rgba(0, 0, 0, 0.08);
    color: var(--text-primary);
  }

  /* Inline code — dark orange on light bg for WCAG AA contrast              */
  .markdown-body code {
    color: #A03000;
  }

  /* Scrollbar thumb */
  ::-webkit-scrollbar-thumb { background: rgba(0, 0, 0, 0.20); }
}
